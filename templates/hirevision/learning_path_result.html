{% extends 'base.html' %}

{% block title %}Learning Path Result - HireVision{% endblock %}

{% block extra_css %}
<style>
    .path-container {
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        min-height: 100vh;
        padding: 2rem 0;
    }

    .path-header {
        text-align: center;
        margin-bottom: 3rem;
        padding: 2rem 0;
    }

    .path-title {
        font-size: 3rem;
        font-weight: 700;
        color: var(--dark-color);
        margin-bottom: 1rem;
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .path-subtitle {
        font-size: 1.25rem;
        color: var(--secondary-color);
        max-width: 800px;
        margin: 0 auto;
        line-height: 1.6;
        word-wrap: break-word;
        overflow-wrap: break-word;
        hyphens: auto;
        background: linear-gradient(135deg, rgba(37, 99, 235, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
        padding: 1.5rem;
        border-radius: 12px;
        border-left: 4px solid var(--primary-color);
        margin-bottom: 2rem;
    }

    .path-card {
        background: white;
        border-radius: 16px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        border: none;
        margin-bottom: 2rem;
        transition: all 0.3s ease;
    }

    .path-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
    }

    .card-header {
        padding: 1.5rem;
        text-align: center;
        color: white;
        position: relative;
        overflow: hidden;
    }

    .card-header.role-analysis {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
    }

    .card-header.skills-gap {
        background: linear-gradient(135deg, var(--danger-color) 0%, #dc2626 100%);
    }

    .card-header.learning-journey {
        background: linear-gradient(135deg, var(--success-color) 0%, #059669 100%);
    }

    .card-header.timeline {
        background: linear-gradient(135deg, var(--accent-color) 0%, #d97706 100%);
    }

    .card-header.metrics {
        background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
    }

    .card-header.career-advice {
        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
    }

    .card-header.networking {
        background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
    }

    .card-header h3 {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    .card-header p {
        font-size: 0.9rem;
        opacity: 0.9;
        margin-bottom: 0;
    }

    .card-body {
        padding: 2rem;
    }

    .role-content {
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        border-radius: 12px;
        padding: 2rem;
        line-height: 1.8;
        color: var(--dark-color);
        border: 1px solid var(--border-color);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .role-content h4 {
        color: var(--primary-color);
        font-weight: 600;
        margin-bottom: 1rem;
        font-size: 1.1rem;
    }

    .role-content ul {
        margin-left: 1.5rem;
        margin-bottom: 1rem;
    }

    .role-content li {
        margin-bottom: 0.5rem;
    }

    .skills-gap-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
    }

    .skill-gap-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1.5rem;
        background: linear-gradient(135deg, rgba(220, 38, 38, 0.08) 0%, rgba(239, 68, 68, 0.12) 100%);
        border-radius: 12px;
        border-left: 4px solid var(--danger-color);
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(220, 38, 38, 0.1);
    }

    .skill-gap-item:hover {
        transform: translateX(4px);
        background: linear-gradient(135deg, rgba(220, 38, 38, 0.12) 0%, rgba(239, 68, 68, 0.16) 100%);
        box-shadow: 0 4px 12px rgba(220, 38, 38, 0.15);
    }

    .skill-gap-item i {
        color: var(--danger-color);
        font-size: 1.3rem;
        width: 24px;
        text-align: center;
        background: rgba(220, 38, 38, 0.1);
        padding: 0.5rem;
        border-radius: 50%;
    }

    .skill-gap-item span {
        font-weight: 600;
        color: var(--dark-color);
        font-size: 1rem;
        line-height: 1.4;
    }

    .phase-card {
        background: var(--light-color);
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        border-left: 4px solid var(--success-color);
        transition: all 0.3s ease;
    }

    .phase-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .phase-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .phase-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--primary-color);
        margin-bottom: 0;
    }

    .phase-duration {
        background: var(--primary-color);
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.875rem;
        font-weight: 500;
    }

    .phase-description {
        color: var(--secondary-color);
        line-height: 1.6;
        margin-bottom: 1.5rem;
    }

    .skills-badges {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 1.5rem;
    }

    .skill-badge {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.875rem;
        font-weight: 500;
    }

    .resource-item {
        background: white;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
        border: 1px solid var(--border-color);
        transition: all 0.3s ease;
    }

    .resource-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .resource-header {
        display: flex;
        justify-content: between;
        align-items: flex-start;
        gap: 1rem;
        margin-bottom: 0.5rem;
    }

    .resource-info h6 {
        font-weight: 600;
        color: var(--dark-color);
        margin-bottom: 0.25rem;
    }

    .resource-description {
        font-size: 0.875rem;
        color: var(--secondary-color);
        margin-bottom: 0.5rem;
    }

    .resource-badges {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
    }

    .resource-badge {
        padding: 0.25rem 0.5rem;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 500;
    }

    .resource-badge.difficulty {
        background: var(--light-color);
        color: var(--secondary-color);
    }

    .resource-badge.verified {
        background: var(--success-color);
        color: white;
    }

    .project-item {
        background: white;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
        border: 1px solid var(--border-color);
        transition: all 0.3s ease;
    }

    .project-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .project-title {
        font-weight: 600;
        color: var(--dark-color);
        margin-bottom: 0.5rem;
    }

    .project-description {
        color: var(--secondary-color);
        margin-bottom: 1rem;
        line-height: 1.5;
    }

    .project-skills {
        margin-bottom: 1rem;
    }

    .project-skills strong {
        color: var(--dark-color);
        margin-right: 0.5rem;
    }

    .project-skill-badge {
        background: var(--info-color);
        color: white;
        padding: 0.25rem 0.5rem;
        border-radius: 12px;
        font-size: 0.75rem;
        margin-right: 0.5rem;
        margin-bottom: 0.25rem;
        display: inline-block;
    }

    .timeline-display {
        background: linear-gradient(135deg, var(--accent-color) 0%, #d97706 100%);
        color: white;
        padding: 2rem;
        border-radius: 12px;
        text-align: center;
    }

    .timeline-value {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    .timeline-label {
        font-size: 1rem;
        opacity: 0.9;
    }

    .metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
    }

    .metric-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        background: var(--light-color);
        border-radius: 12px;
        transition: all 0.3s ease;
    }

    .metric-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .metric-item i {
        color: var(--success-color);
        font-size: 1.2rem;
        width: 20px;
        text-align: center;
    }

    .metric-item span {
        font-weight: 500;
        color: var(--dark-color);
    }

    .career-advice-content {
        background: var(--light-color);
        border-radius: 12px;
        padding: 1.5rem;
    }

    .advice-section {
        margin-bottom: 2rem;
    }

    .advice-section:last-child {
        margin-bottom: 0;
    }

    .advice-section h5 {
        color: var(--primary-color);
        font-weight: 600;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
    }

    .advice-section h5 i {
        margin-right: 0.5rem;
    }

    .advice-content {
        color: var(--dark-color);
        line-height: 1.6;
        margin-bottom: 0;
    }

    .advice-highlight {
        background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(124, 58, 237, 0.1) 100%);
        border-left: 4px solid #8b5cf6;
        padding: 1rem;
        border-radius: 8px;
        margin: 1rem 0;
    }

    .advice-highlight strong {
        color: #8b5cf6;
    }

    .networking-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
    }

    .networking-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        background: var(--light-color);
        border-radius: 12px;
        transition: all 0.3s ease;
    }

    .networking-item:hover {
        transform: translateX(4px);
        background: rgba(37, 99, 235, 0.05);
    }

    .networking-item i {
        color: var(--primary-color);
        font-size: 1.2rem;
        width: 20px;
        text-align: center;
    }

    .networking-item span {
        font-weight: 500;
        color: var(--dark-color);
    }

    .action-section {
        background: white;
        border-radius: 16px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        border: none;
        margin-bottom: 2rem;
    }

    .action-header {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
        color: white;
        padding: 1.5rem;
        text-align: center;
    }

    .action-header h3 {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    .action-content {
        padding: 2rem;
    }

    .action-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
    }

    .action-btn {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
        border: none;
        border-radius: 12px;
        padding: 1.5rem;
        font-weight: 600;
        font-size: 1rem;
        color: white;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.75rem;
        text-decoration: none;
        text-align: center;
    }

    .action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(37, 99, 235, 0.4);
        color: white;
        text-decoration: none;
    }

    .action-btn.resume {
        background: linear-gradient(135deg, var(--success-color) 0%, #059669 100%);
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    .action-btn.resume:hover {
        box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
    }

    .action-btn.analyze {
        background: linear-gradient(135deg, var(--accent-color) 0%, #d97706 100%);
        box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
    }

    .action-btn.analyze:hover {
        box-shadow: 0 8px 20px rgba(245, 158, 11, 0.4);
    }

    .action-btn.new-analysis {
        background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }

    .action-btn.new-analysis:hover {
        box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);
    }

    .details-card {
        background: white;
        border-radius: 16px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        border: none;
    }

    .details-header {
        background: linear-gradient(135deg, var(--secondary-color) 0%, #64748b 100%);
        color: white;
        padding: 1.5rem;
        text-align: center;
    }

    .details-header h3 {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    .details-content {
        padding: 2rem;
    }

    .details-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
    }

    .detail-item {
        background: var(--light-color);
        border-radius: 12px;
        padding: 1rem;
        text-align: center;
    }

    .detail-label {
        font-size: 0.875rem;
        color: var(--secondary-color);
        margin-bottom: 0.5rem;
        font-weight: 500;
    }

    .detail-value {
        font-size: 1.125rem;
        color: var(--dark-color);
        font-weight: 600;
    }

    /* Enhanced Loading Animation Styles */
    .loading-animation {
        position: relative;
        display: inline-block;
    }

    .ai-roadmap {
        position: relative;
        display: inline-block;
    }

    .ai-roadmap i {
        position: relative;
        z-index: 3;
        animation: roadmap-pulse 2s ease-in-out infinite;
    }

    .pulse-ring {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 80px;
        height: 80px;
        border: 3px solid var(--success-color);
        border-radius: 50%;
        opacity: 0;
        animation: pulse 2s ease-out infinite;
    }

    .pulse-ring.delay-1 {
        animation-delay: 0.5s;
    }

    .pulse-ring.delay-2 {
        animation-delay: 1s;
    }

    @keyframes pulse {
        0% {
            transform: translate(-50%, -50%) scale(0.8);
            opacity: 1;
        }
        100% {
            transform: translate(-50%, -50%) scale(2);
            opacity: 0;
        }
    }

    @keyframes roadmap-pulse {
        0%, 100% {
            transform: scale(1);
        }
        50% {
            transform: scale(1.1);
        }
    }

    /* Status Container Styles */
    .status-container h3 {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: var(--dark-color);
    }

    .status-container p {
        font-size: 1rem;
        color: var(--secondary-color);
        margin-bottom: 0;
    }

    /* Progress Container Styles */
    .progress-container {
        background: white;
        padding: 1.5rem;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        border: 1px solid var(--border-color);
    }

    .progress {
        background-color: #e9ecef;
        overflow: hidden;
    }

    .progress-bar {
        transition: width 0.5s ease;
    }

    /* Loading Tips Styles */
    .loading-tips {
        max-width: 600px;
        margin: 0 auto;
    }

    .tip-card {
        background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
        border: 1px solid #ffc107;
        border-radius: 12px;
        padding: 1rem 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        box-shadow: 0 2px 8px rgba(255, 193, 7, 0.2);
    }

    .tip-card i {
        font-size: 1.2rem;
        flex-shrink: 0;
    }

    .tip-card span {
        font-weight: 500;
        color: #856404;
        line-height: 1.5;
    }

    /* Cancel Button Styles */
    #cancel-analysis {
        transition: all 0.3s ease;
        border-radius: 20px;
        padding: 0.5rem 1.5rem;
    }

    #cancel-analysis:hover {
        background-color: var(--danger-color);
        border-color: var(--danger-color);
        color: white;
        transform: translateY(-1px);
    }

    @media (max-width: 768px) {
        .path-title {
            font-size: 2.5rem;
        }
        
        .card-body {
            padding: 1.5rem;
        }
        
        .skills-gap-grid {
            grid-template-columns: 1fr;
        }
        
        .metrics-grid {
            grid-template-columns: 1fr;
        }
        
        .networking-grid {
            grid-template-columns: 1fr;
        }
        
        .action-grid {
            grid-template-columns: 1fr;
        }
        
        .details-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="path-container">
    <div class="container">
        <!-- Header -->
        <div class="path-header">
            <h1 class="path-title">Your Learning Path</h1>
            <p class="path-subtitle" title="{{ learning_path.dream_role }}">AI-Generated Roadmap to "{{ learning_path.dream_role|truncatechars:300 }}"</p>
        </div>

        <!-- Enhanced Loading State -->
        <div id="loading-state"{% if learning_path.task_status == 'completed' %} style="display: none;"{% endif %}>
            <div class="text-center">
                <!-- Animated Loading Icon -->
                <div class="loading-animation mb-4">
                    <div class="ai-roadmap">
                        <i class="fas fa-road fa-3x text-success"></i>
                        <div class="pulse-ring"></div>
                        <div class="pulse-ring delay-1"></div>
                        <div class="pulse-ring delay-2"></div>
                    </div>
                </div>
                
                <!-- Dynamic Status Messages -->
                <div class="status-container mb-4">
                    <h3 id="status-title">Analyzing Your Career Goals...</h3>
                    <p id="status-description" class="text-muted">Understanding your current skills and target role</p>
                </div>
                
                <!-- Progress Bar with Time Estimate -->
                <div class="progress-container" style="max-width: 500px; margin: 0 auto;">
                    <div class="progress mb-2" style="height: 8px; border-radius: 10px;">
                        <div id="progress-bar" class="progress-bar progress-bar-striped progress-bar-animated" 
                             role="progressbar" style="width: 0%; border-radius: 10px; background: linear-gradient(90deg, var(--success-color) 0%, #059669 100%);"></div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <small class="text-muted" id="progress-text">0% Complete</small>
                        <small class="text-muted" id="time-estimate">Estimated: 45 seconds</small>
                    </div>
                </div>
                
                <!-- Loading Tips -->
                <div class="loading-tips mt-4">
                    <div class="tip-card">
                        <i class="fas fa-lightbulb text-warning"></i>
                        <span id="loading-tip">While you wait, think about your long-term career goals and the skills you want to develop.</span>
                    </div>
                </div>
                
                <!-- Cancel Option -->
                <div class="mt-4">
                    <button id="cancel-analysis" class="btn btn-outline-secondary btn-sm">
                        <i class="fas fa-times me-2"></i>Cancel Analysis
                    </button>
                </div>
            </div>
        </div>

        <!-- Error State -->
        <div id="error-state" style="display: none;">
            <div class="text-center">
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-triangle fa-2x mb-3"></i>
                    <h4>Learning Path Generation Failed</h4>
                    <p id="error-message">An error occurred while creating your learning path. Please try again.</p>
                    <a href="{% url 'hirevision:learning_path_analyzer' %}" class="btn btn-success">Try Again</a>
                </div>
            </div>
        </div>

        <!-- Results Content -->
        <div id="results-content"{% if learning_path.task_status != 'completed' %} style="display: none;"{% endif %}>
        <div class="row justify-content-center">
            <div class="col-lg-12">
                <!-- Error Display -->
                {% if learning_path.task_status == 'failed' %}
                    <div class="alert alert-danger">
                        <h4><i class="fas fa-exclamation-triangle me-2"></i>Learning Path Generation Failed</h4>
                        {% if learning_path.task_error %}
                            <div class="mt-3">
                                {{ learning_path.task_error|linebreaks }}
                            </div>
                        {% else %}
                            <p>An unexpected error occurred while generating your learning path. Please try again.</p>
                        {% endif %}
                        <div class="mt-3">
                            <a href="{% url 'hirevision:learning_path_analyzer' %}" class="btn btn-success">
                                <i class="fas fa-redo me-2"></i>Try Again
                            </a>
                        </div>
                    </div>
                {% endif %}

                <!-- Role Analysis -->
                <div class="path-card">
                    <div class="card-header role-analysis">
                        <h3><i class="fas fa-briefcase me-2"></i>Role Analysis</h3>
                        <p>Understanding your target role requirements</p>
                    </div>
                    <div class="card-body">
                        <div class="role-content">
                            {% if learning_path.role_analysis %}
                                {% if learning_path.role_analysis|length > 100 %}
                                    <h4>ðŸŽ¯ Career Transition Analysis</h4>
                                    <p>{{ learning_path.role_analysis|linebreaks }}</p>
                                {% else %}
                                    <p>{{ learning_path.role_analysis|linebreaks }}</p>
                                {% endif %}
                            {% else %}
                                <div class="text-center text-muted">
                                    <i class="fas fa-info-circle fa-2x mb-3"></i>
                                    <p>Role analysis is being generated. Please wait a moment and refresh the page.</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Skills Gap Analysis -->
                <div class="path-card">
                    <div class="card-header skills-gap">
                        <h3><i class="fas fa-exclamation-triangle me-2"></i>Skills Gap Analysis</h3>
                        <p>Areas you need to develop</p>
                    </div>
                    <div class="card-body">
                        {% if learning_path.skills_gap and learning_path.skills_gap|length > 0 %}
                            <div class="skills-gap-grid">
                                {% for skill in learning_path.skills_gap %}
                                    <div class="skill-gap-item">
                                        <i class="fas fa-exclamation-triangle"></i>
                                        <span>{{ skill }}</span>
                                    </div>
                                {% endfor %}
                            </div>
                            <div class="mt-4 p-3 bg-warning bg-opacity-10 border border-warning rounded">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-lightbulb text-warning me-2"></i>
                                    <strong class="text-warning">Pro Tip:</strong>
                                    <span class="ms-2">Focus on these skills gaps systematically. Start with foundational skills and gradually move to advanced concepts.</span>
                                </div>
                            </div>
                        {% else %}
                            <div class="text-center text-muted">
                                <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                                <p>Skills gap analysis is being generated. Please wait a moment and refresh the page.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Learning Journey -->
                {% if learning_path.learning_path_data and learning_path.learning_path_data|length > 0 %}
                    <div class="path-card">
                        <div class="card-header learning-journey">
                            <h3><i class="fas fa-road me-2"></i>Your Learning Journey</h3>
                            <p>Structured phases to reach your goal</p>
                        </div>
                        <div class="card-body">
                            {% for phase in learning_path.learning_path_data %}
                                <div class="phase-card">
                                    <div class="phase-header">
                                        <h5 class="phase-title">{{ phase.phase|default:"Phase" }}</h5>
                                        {% if phase.duration %}
                                            <span class="phase-duration">
                                                <i class="fas fa-clock me-1"></i>{{ phase.duration }}
                                            </span>
                                        {% endif %}
                                    </div>
                                    {% if phase.description %}
                                        <p class="phase-description">{{ phase.description }}</p>
                                    {% endif %}
                                    
                                    {% if phase.skills_to_learn and phase.skills_to_learn|length > 0 %}
                                        <div class="mb-3">
                                            <h6><i class="fas fa-graduation-cap me-2"></i>Skills to Learn:</h6>
                                            <div class="skills-badges">
                                                {% for skill in phase.skills_to_learn %}
                                                    <span class="skill-badge">{{ skill }}</span>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    {% endif %}
                                    
                                    {% if phase.resources and phase.resources|length > 0 %}
                                        <div class="mb-3">
                                            <h6><i class="fas fa-book me-2"></i>Recommended Resources:</h6>
                                            {% for resource in phase.resources %}
                                                <div class="resource-item">
                                                    <div class="resource-header">
                                                        <div class="resource-info">
                                                            <h6>{{ resource.name|default:"Resource" }}</h6>
                                                            {% if resource.description %}
                                                                <p class="resource-description">{{ resource.description }}</p>
                                                            {% endif %}
                                                            <div class="resource-badges">
                                                                {% if resource.difficulty %}
                                                                    <span class="resource-badge difficulty">{{ resource.difficulty }}</span>
                                                                {% endif %}
                                                                {% if resource.verified %}
                                                                    <span class="resource-badge verified">
                                                                        <i class="fas fa-check me-1"></i>Verified
                                                                    </span>
                                                                {% endif %}
                                                            </div>
                                                        </div>
                                                        {% if resource.url and resource.url != "placeholder" and resource.url != "#" %}
                                                            <a href="{{ resource.url }}" target="_blank" class="btn btn-sm btn-outline-primary">
                                                                <i class="fas fa-external-link-alt"></i> Visit
                                                            </a>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                    
                                    {% if phase.projects and phase.projects|length > 0 %}
                                        <div class="mb-3">
                                            <h6><i class="fas fa-code me-2"></i>Hands-on Projects:</h6>
                                            {% for project in phase.projects %}
                                                <div class="project-item">
                                                    <h6 class="project-title">{{ project.name|default:"Project" }}</h6>
                                                    {% if project.description %}
                                                        <p class="project-description">{{ project.description }}</p>
                                                    {% endif %}
                                                    {% if project.skills_practiced and project.skills_practiced|length > 0 %}
                                                        <div class="project-skills">
                                                            <strong>Skills practiced:</strong>
                                                            {% for skill in project.skills_practiced %}
                                                                <span class="project-skill-badge">{{ skill }}</span>
                                                            {% endfor %}
                                                        </div>
                                                    {% endif %}
                                                    {% if project.github_template and project.github_template != "placeholder" %}
                                                        <a href="{{ project.github_template }}" target="_blank" class="btn btn-sm btn-outline-dark">
                                                            <i class="fab fa-github"></i> Template
                                                        </a>
                                                    {% endif %}
                                                </div>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                {% if not forloop.last %}
                                    <hr class="my-4">
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                {% else %}
                    <div class="path-card">
                        <div class="card-header learning-journey">
                            <h3><i class="fas fa-road me-2"></i>Your Learning Journey</h3>
                            <p>Structured phases to reach your goal</p>
                        </div>
                        <div class="card-body">
                            <div class="text-center text-muted">
                                <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                                <p>Learning path phases are being generated. Please wait a moment and refresh the page.</p>
                            </div>
                        </div>
                    </div>
                {% endif %}

                <!-- Timeline -->
                {% if learning_path.timeline %}
                    <div class="path-card">
                        <div class="card-header timeline">
                            <h3><i class="fas fa-clock me-2"></i>Overall Timeline</h3>
                            <p>Estimated duration for your journey</p>
                        </div>
                        <div class="card-body">
                            <div class="timeline-display">
                                <div class="timeline-value">{{ learning_path.timeline }}</div>
                                <div class="timeline-label">Estimated completion time</div>
                            </div>
                        </div>
                    </div>
                {% endif %}

                <!-- Success Metrics -->
                {% if learning_path.success_metrics and learning_path.success_metrics|length > 0 %}
                    <div class="path-card">
                        <div class="card-header metrics">
                            <h3><i class="fas fa-chart-line me-2"></i>Success Metrics</h3>
                            <p>Track your progress with these measurable goals</p>
                        </div>
                        <div class="card-body">
                            <div class="metrics-grid">
                                {% for metric in learning_path.success_metrics %}
                                    <div class="metric-item">
                                        <i class="fas fa-check-circle"></i>
                                        <span>{{ metric }}</span>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                {% endif %}

                <!-- Career Advice -->
                {% if learning_path.career_advice %}
                    <div class="path-card">
                        <div class="card-header career-advice">
                            <h3><i class="fas fa-lightbulb me-2"></i>Career Advice</h3>
                            <p>Strategic guidance for your career transition</p>
                        </div>
                        <div class="card-body">
                            <div class="career-advice-content">
                                {{ learning_path.career_advice|linebreaks }}
                            </div>
                        </div>
                    </div>
                {% endif %}

                <!-- Networking Tips -->
                {% if learning_path.networking_tips and learning_path.networking_tips|length > 0 %}
                    <div class="path-card">
                        <div class="card-header networking">
                            <h3><i class="fas fa-users me-2"></i>Networking Tips</h3>
                            <p>Build connections in your target industry</p>
                        </div>
                        <div class="card-body">
                            <div class="networking-grid">
                                {% for tip in learning_path.networking_tips %}
                                    <div class="networking-item">
                                        <i class="fas fa-handshake"></i>
                                        <span>{{ tip }}</span>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                {% endif %}

                <!-- Action Section -->
                <div class="action-section">
                    <div class="action-header">
                        <h3><i class="fas fa-rocket me-2"></i>What's Next?</h3>
                        <p>Take action to accelerate your career growth</p>
                    </div>
                    <div class="action-content">
                        <div class="action-grid">
                            <a href="{% url 'hirevision:resume_builder' %}" class="action-btn resume">
                                <i class="fas fa-tools"></i>
                                <div>
                                    <div>Build Resume</div>
                                    <small>Create an optimized resume</small>
                                </div>
                            </a>
                            <a href="{% url 'hirevision:resume_analyzer' %}" class="action-btn analyze">
                                <i class="fas fa-file-alt"></i>
                                <div>
                                    <div>Analyze Resume</div>
                                    <small>Test your current resume</small>
                                </div>
                            </a>
                            <a href="{% url 'hirevision:learning_path_analyzer' %}" class="action-btn new-analysis">
                                <i class="fas fa-redo"></i>
                                <div>
                                    <div>New Analysis</div>
                                    <small>Plan a different path</small>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>


            </div>
        </div>
        </div> <!-- Close results-content -->
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const pathId = '{{ learning_path.id }}';
    const taskStatus = '{{ learning_path.task_status }}';
    const startTime = Date.now();
    let pollCount = 0;
    let progressInterval;
    let tipInterval;
    
    const loadingState = document.getElementById('loading-state');
    const errorState = document.getElementById('error-state');
    const resultsContent = document.getElementById('results-content');
    
    // Enhanced status messages with more realistic progression
    const statusMessages = [
        { title: 'Analyzing Your Skills...', description: 'Understanding your current technical background and experience', progress: 10 },
        { title: 'Evaluating Target Role...', description: 'Analyzing requirements for your dream position', progress: 25 },
        { title: 'Identifying Skills Gaps...', description: 'Mapping the difference between current and required skills', progress: 40 },
        { title: 'Designing Learning Phases...', description: 'Creating structured learning phases for your journey', progress: 55 },
        { title: 'Researching Resources...', description: 'Finding verified courses, books, and learning materials', progress: 70 },
        { title: 'Planning Projects...', description: 'Designing hands-on projects to practice your skills', progress: 80 },
        { title: 'Generating Career Advice...', description: 'Preparing personalized career transition strategies', progress: 90 },
        { title: 'Finalizing Your Roadmap...', description: 'Completing your comprehensive learning path', progress: 95 }
    ];
    
    // Enhanced loading tips with more specific advice
    const loadingTips = [
        'While you wait, think about your long-term career goals and the skills you want to develop.',
        'Did you know? Most successful career transitions involve both technical and soft skills.',
        'Tip: Consider networking opportunities in your target industry while learning.',
        'Remember to set realistic timelines for your learning journey.',
        'Pro tip: Focus on skills that are in high demand in your target role.',
        'Consider getting certifications that are recognized in your target industry.',
        'Think about how your current experience can transfer to your new role.',
        'Start building a portfolio of projects that demonstrate your target skills.',
        'Research companies and roles in your target industry to understand requirements.',
        'Consider finding a mentor who has made a similar career transition.'
    ];
    
    // Handle different initial states
    if (taskStatus === 'failed') {
        // Show error state immediately
        loadingState.style.display = 'none';
        resultsContent.style.display = 'block';
        // Error will be displayed in the template
    } else if (taskStatus === 'completed') {
        // Show results immediately
        loadingState.style.display = 'none';
        resultsContent.style.display = 'block';
    } else {
        // Start polling for status updates
        startEnhancedPolling();
        startProgressSimulation();
        startTipRotation();
    }
    
    // Cancel analysis button
    const cancelButton = document.getElementById('cancel-analysis');
    if (cancelButton) {
        cancelButton.addEventListener('click', function() {
            if (confirm('Are you sure you want to cancel this analysis? You will need to start over.')) {
                window.location.href = '{% url "hirevision:learning_path_analyzer" %}';
            }
        });
    }
    
    function startEnhancedPolling() {
        pollTaskStatus();
    }
    
    function startProgressSimulation() {
        let currentProgress = 0;
        let currentStage = 0;
        
        progressInterval = setInterval(() => {
            if (currentProgress < 95) {
                // More realistic progress increments
                const increment = Math.random() * 1.5 + 0.5; // 0.5 to 2.0
                currentProgress += increment;
                updateProgress(currentProgress);
                
                // Update status message based on progress
                if (currentProgress > statusMessages[currentStage].progress && currentStage < statusMessages.length - 1) {
                    currentStage++;
                    updateStatus(statusMessages[currentStage]);
                }
            }
        }, 1200); // Slightly slower for more realistic feel
    }
    
    function startTipRotation() {
        let tipIndex = 0;
        tipInterval = setInterval(() => {
            const tipElement = document.getElementById('loading-tip');
            if (tipElement) {
                tipElement.textContent = loadingTips[tipIndex];
                tipIndex = (tipIndex + 1) % loadingTips.length;
            }
        }, 10000); // Change tip every 10 seconds
    }
    
    function updateProgress(progress) {
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const timeEstimate = document.getElementById('time-estimate');
        
        if (progressBar && progressText && timeEstimate) {
            progressBar.style.width = Math.min(progress, 95) + '%';
            progressText.textContent = Math.round(progress) + '% Complete';
            
            // Calculate remaining time with more realistic estimates
            const elapsed = (Date.now() - startTime) / 1000;
            const estimatedTotal = 60; // 60 seconds total for more realistic estimate
            const remaining = Math.max(0, estimatedTotal - elapsed);
            
            if (remaining > 60) {
                timeEstimate.textContent = `Estimated: ${Math.round(remaining / 60)} minutes`;
            } else {
                timeEstimate.textContent = `Estimated: ${Math.round(remaining)} seconds`;
            }
        }
    }
    
    function updateStatus(status) {
        const titleElement = document.getElementById('status-title');
        const descriptionElement = document.getElementById('status-description');
        
        if (titleElement && descriptionElement) {
            // Add fade effect
            titleElement.style.opacity = '0';
            descriptionElement.style.opacity = '0';
            
            setTimeout(() => {
                titleElement.textContent = status.title;
                descriptionElement.textContent = status.description;
                titleElement.style.opacity = '1';
                descriptionElement.style.opacity = '1';
            }, 200);
        }
    }
    
    function pollTaskStatus() {
        pollCount++;
        
        fetch(`/api/learning-path/${pathId}/status/`)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('Task status response:', data);
                
                if (data.status === 'completed') {
                    clearInterval(progressInterval);
                    clearInterval(tipInterval);
                    updateProgress(100);
                    updateStatus({ title: 'Learning Path Complete!', description: 'Your personalized roadmap is ready' });
                    
                    setTimeout(() => {
                        // Reload page to show results
                        window.location.reload();
                    }, 2000);
                } else if (data.status === 'failed') {
                    clearInterval(progressInterval);
                    clearInterval(tipInterval);
                    showError(data.error || 'Learning path generation failed. Please try again.');
                } else if (data.status === 'running' || data.status === 'pending') {
                    // Continue polling with exponential backoff
                    const delay = Math.min(3000 + (pollCount * 1000), 15000); // Max 15 seconds
                    setTimeout(pollTaskStatus, delay);
                } else {
                    // Unknown status, retry with longer delay
                    setTimeout(pollTaskStatus, 10000);
                }
            })
            .catch(error => {
                console.error('Error checking task status:', error);
                if (pollCount < 8) { // Increased retry count
                    // Retry with exponential backoff
                    const delay = Math.min(5000 + (pollCount * 2000), 30000); // Max 30 seconds
                    setTimeout(pollTaskStatus, delay);
                } else {
                    showError('Unable to check learning path status. Please refresh the page or try again. If the problem persists, contact support.');
                }
            });
    }
    
    function showError(message) {
        clearInterval(progressInterval);
        clearInterval(tipInterval);
        
        if (loadingState) {
            loadingState.style.display = 'none';
        }
        
        const errorMessageElement = document.getElementById('error-message');
        if (errorMessageElement) {
            errorMessageElement.textContent = message;
        }
        
        if (errorState) {
            errorState.style.display = 'block';
        }
    }
    
    // Add smooth transitions
    const style = document.createElement('style');
    style.textContent = `
        #status-title, #status-description {
            transition: opacity 0.3s ease;
        }
        .progress-bar {
            transition: width 0.5s ease;
        }
        .tip-card {
            transition: all 0.3s ease;
        }
        .tip-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
        }
    `;
    document.head.appendChild(style);
});
</script>
{% endblock %} 